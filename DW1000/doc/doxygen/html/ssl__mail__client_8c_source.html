<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>third_party/mbedtls/repo/programs/ssl/ssl_mail_client.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Open-Thread-Logo-200x42.png"/></td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief">CLI and NCP Application</div>
    </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_44f42edf5dd23d4deca0321224e9ce90.html">third_party</a></li><li class="navelem"><a class="el" href="dir_2c3d6607fdac3e9186e98b5e2f588509.html">mbedtls</a></li><li class="navelem"><a class="el" href="dir_2dc104378b4059f668847b2a8b47063b.html">repo</a></li><li class="navelem"><a class="el" href="dir_56672f937ec54928cff4eb4c52e260b9.html">programs</a></li><li class="navelem"><a class="el" href="dir_a18bd21d6b588a1259543221e90683f7.html">ssl</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ssl_mail_client.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="ssl__mail__client_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *  SSL client for SMTP servers</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *  Copyright (C) 2006-2015, ARM Limited, All Rights Reserved</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *  SPDX-License-Identifier: Apache-2.0</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *  not use this file except in compliance with the License.</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *  You may obtain a copy of the License at</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *  http://www.apache.org/licenses/LICENSE-2.0</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *  Unless required by applicable law or agreed to in writing, software</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> *  distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> *  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> *  See the License for the specific language governing permissions and</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> *  limitations under the License.</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> *  This file is part of mbed TLS (https://tls.mbed.org)</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#if !defined(MBEDTLS_CONFIG_FILE)</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="config_8h.html">mbedtls/config.h</a>&quot;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include MBEDTLS_CONFIG_FILE</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_PLATFORM_C)</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="third__party_2mbedtls_2repo_2include_2mbedtls_2platform_8h.html">mbedtls/platform.h</a>&quot;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &lt;stdlib.h&gt;</span></div><div class="line"><a name="l00033"></a><span class="lineno"><a class="line" href="ssl__mail__client_8c.html#a85fcfc46e7a73613d58f5aa698226a96">   33</a></span>&#160;<span class="preprocessor">#define mbedtls_time       time</span></div><div class="line"><a name="l00034"></a><span class="lineno"><a class="line" href="ssl__mail__client_8c.html#ab31374c1eadaa818b832ffef65db5389">   34</a></span>&#160;<span class="preprocessor">#define mbedtls_time_t     time_t </span></div><div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="ssl__mail__client_8c.html#a6d045f0c3699e1eac7f723054dc8b3e4">   35</a></span>&#160;<span class="preprocessor">#define mbedtls_fprintf    fprintf</span></div><div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">   36</a></span>&#160;<span class="preprocessor">#define mbedtls_printf     printf</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#if !defined(MBEDTLS_BIGNUM_C) || !defined(MBEDTLS_ENTROPY_C) ||  \</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">    !defined(MBEDTLS_SSL_TLS_C) || !defined(MBEDTLS_SSL_CLI_C) || \</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">    !defined(MBEDTLS_NET_C) || !defined(MBEDTLS_RSA_C) ||         \</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">    !defined(MBEDTLS_CTR_DRBG_C) || !defined(MBEDTLS_X509_CRT_PARSE_C) || \</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">    !defined(MBEDTLS_FS_IO)</span></div><div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="ssl__mail__client_8c.html#a840291bc02cba5474a4cb46a9b9566fe">   44</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="ssl__mail__client_8c.html#a840291bc02cba5474a4cb46a9b9566fe">main</a>( <span class="keywordtype">void</span> )</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;{</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>(<span class="stringliteral">&quot;MBEDTLS_BIGNUM_C and/or MBEDTLS_ENTROPY_C and/or &quot;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;           <span class="stringliteral">&quot;MBEDTLS_SSL_TLS_C and/or MBEDTLS_SSL_CLI_C and/or &quot;</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;           <span class="stringliteral">&quot;MBEDTLS_NET_C and/or MBEDTLS_RSA_C and/or &quot;</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;           <span class="stringliteral">&quot;MBEDTLS_CTR_DRBG_C and/or MBEDTLS_X509_CRT_PARSE_C &quot;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;           <span class="stringliteral">&quot;not defined.\n&quot;</span>);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;}</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="base64_8h.html">mbedtls/base64.h</a>&quot;</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="error_8h.html">mbedtls/error.h</a>&quot;</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="net__sockets_8h.html">mbedtls/net_sockets.h</a>&quot;</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ssl_8h.html">mbedtls/ssl.h</a>&quot;</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="entropy_8h.html">mbedtls/entropy.h</a>&quot;</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ctr__drbg_8h.html">mbedtls/ctr_drbg.h</a>&quot;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="certs_8h.html">mbedtls/certs.h</a>&quot;</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="x509_8h.html">mbedtls/x509.h</a>&quot;</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#include &lt;stdlib.h&gt;</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">#include &lt;string.h&gt;</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#if !defined(_MSC_VER) || defined(EFIX64) || defined(EFI32)</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#include &lt;unistd.h&gt;</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#include &lt;io.h&gt;</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">#if defined(_WIN32) || defined(_WIN32_WCE)</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">#include &lt;winsock2.h&gt;</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor">#include &lt;windows.h&gt;</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="preprocessor">#if defined(_MSC_VER)</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor">#if defined(_WIN32_WCE)</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="preprocessor">#pragma comment( lib, &quot;ws2.lib&quot; )</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="preprocessor">#pragma comment( lib, &quot;ws2_32.lib&quot; )</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* _MSC_VER */</span><span class="preprocessor"></span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="preprocessor">#define DFL_SERVER_NAME         &quot;localhost&quot;</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="preprocessor">#define DFL_SERVER_PORT         &quot;465&quot;</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="preprocessor">#define DFL_USER_NAME           &quot;user&quot;</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="preprocessor">#define DFL_USER_PWD            &quot;password&quot;</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="preprocessor">#define DFL_MAIL_FROM           &quot;&quot;</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="preprocessor">#define DFL_MAIL_TO             &quot;&quot;</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="preprocessor">#define DFL_DEBUG_LEVEL         0</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="preprocessor">#define DFL_CA_FILE             &quot;&quot;</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="preprocessor">#define DFL_CRT_FILE            &quot;&quot;</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="preprocessor">#define DFL_KEY_FILE            &quot;&quot;</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="preprocessor">#define DFL_FORCE_CIPHER        0</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="preprocessor">#define DFL_MODE                0</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="preprocessor">#define DFL_AUTHENTICATION      0</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="preprocessor">#define MODE_SSL_TLS            0</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="preprocessor">#define MODE_STARTTLS           0</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_BASE64_C)</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="preprocessor">#define USAGE_AUTH \</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="preprocessor">    &quot;    authentication=%%d   default: 0 (disabled)\n&quot;      \</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="preprocessor">    &quot;    user_name=%%s        default: \&quot;user\&quot;\n&quot;          \</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="preprocessor">    &quot;    user_pwd=%%s         default: \&quot;password\&quot;\n&quot;</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="preprocessor">#define USAGE_AUTH \</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="preprocessor">    &quot;    authentication options disabled. (Require MBEDTLS_BASE64_C)\n&quot;</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* MBEDTLS_BASE64_C */</span><span class="preprocessor"></span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_FS_IO)</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="preprocessor">#define USAGE_IO \</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="preprocessor">    &quot;    ca_file=%%s          default: \&quot;\&quot; (pre-loaded)\n&quot; \</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="preprocessor">    &quot;    crt_file=%%s         default: \&quot;\&quot; (pre-loaded)\n&quot; \</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="preprocessor">    &quot;    key_file=%%s         default: \&quot;\&quot; (pre-loaded)\n&quot;</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="preprocessor">#define USAGE_IO \</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="preprocessor">    &quot;    No file operations available (MBEDTLS_FS_IO not defined)\n&quot;</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* MBEDTLS_FS_IO */</span><span class="preprocessor"></span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="preprocessor">#define USAGE \</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="preprocessor">    &quot;\n usage: ssl_mail_client param=&lt;&gt;...\n&quot;               \</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="preprocessor">    &quot;\n acceptable parameters:\n&quot;                           \</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="preprocessor">    &quot;    server_name=%%s      default: localhost\n&quot;         \</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="preprocessor">    &quot;    server_port=%%d      default: 4433\n&quot;              \</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="preprocessor">    &quot;    debug_level=%%d      default: 0 (disabled)\n&quot;      \</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="preprocessor">    &quot;    mode=%%d             default: 0 (SSL/TLS) (1 for STARTTLS)\n&quot;  \</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="preprocessor">    USAGE_AUTH                                              \</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="preprocessor">    &quot;    mail_from=%%s        default: \&quot;\&quot;\n&quot;              \</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="preprocessor">    &quot;    mail_to=%%s          default: \&quot;\&quot;\n&quot;              \</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="preprocessor">    USAGE_IO                                                \</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="preprocessor">    &quot;    force_ciphersuite=&lt;name&gt;    default: all enabled\n&quot;\</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="preprocessor">    &quot; acceptable ciphersuite names:\n&quot;</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment"> * global options</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="keyword">struct </span>options</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;{</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *server_name;    <span class="comment">/* hostname of the server (client only)     */</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *server_port;    <span class="comment">/* port on which the ssl service runs       */</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordtype">int</span> debug_level;            <span class="comment">/* level of debugging                       */</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordtype">int</span> authentication;         <span class="comment">/* if authentication is required            */</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordtype">int</span> mode;                   <span class="comment">/* SSL/TLS (0) or STARTTLS (1)              */</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *user_name;      <span class="comment">/* username to use for authentication       */</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *user_pwd;       <span class="comment">/* password to use for authentication       */</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *mail_from;      <span class="comment">/* E-Mail address to use as sender          */</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *mail_to;        <span class="comment">/* E-Mail address to use as recipient       */</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *ca_file;        <span class="comment">/* the file with the CA certificate(s)      */</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *crt_file;       <span class="comment">/* the file with the client certificate     */</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *key_file;       <span class="comment">/* the file with the client key             */</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keywordtype">int</span> force_ciphersuite[2];   <span class="comment">/* protocol/ciphersuite to use, or all      */</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;} opt;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> my_debug( <span class="keywordtype">void</span> *ctx, <span class="keywordtype">int</span> <a class="code" href="namespaceautothreadharness_1_1runner.html#afde8e18a788ccc92fc61cab298bca7e3">level</a>,</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                      <span class="keyword">const</span> <span class="keywordtype">char</span> *file, <span class="keywordtype">int</span> line,</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                      <span class="keyword">const</span> <span class="keywordtype">char</span> *str )</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;{</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    ((void) level);</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="ssl__mail__client_8c.html#a6d045f0c3699e1eac7f723054dc8b3e4">mbedtls_fprintf</a>( (FILE *) ctx, <span class="stringliteral">&quot;%s:%04d: %s&quot;</span>, file, line, str );</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    fflush(  (FILE *) ctx  );</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;}</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> do_handshake( <a class="code" href="structmbedtls__ssl__context.html">mbedtls_ssl_context</a> *ssl )</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;{</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <a class="code" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> flags;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buf[1024];</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    memset(buf, 0, 1024);</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">     * 4. Handshake</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot;  . Performing the SSL/TLS handshake...&quot;</span> );</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    fflush( stdout );</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordflow">while</span>( ( ret = <a class="code" href="ssl_8h.html#a4a37e497cd08c896870a42b1b618186e">mbedtls_ssl_handshake</a>( ssl ) ) != 0 )</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    {</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="keywordflow">if</span>( ret != <a class="code" href="ssl_8h.html#a67a1e093cf042831aa60bb567915b560">MBEDTLS_ERR_SSL_WANT_READ</a> &amp;&amp; ret != <a class="code" href="ssl_8h.html#a674bde213fbbf602e04bbc131dd2dc33">MBEDTLS_ERR_SSL_WANT_WRITE</a> )</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        {</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_ERROR_C)</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            <a class="code" href="error_8h.html#a8c41c149b77a4807115b19c2af858558">mbedtls_strerror</a>( ret, (<span class="keywordtype">char</span> *) buf, 1024 );</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;            <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; failed\n  ! mbedtls_ssl_handshake returned %d: %s\n\n&quot;</span>, ret, buf );</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            <span class="keywordflow">return</span>( -1 );</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        }</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    }</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; ok\n    [ Ciphersuite is %s ]\n&quot;</span>,</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;            <a class="code" href="ssl_8h.html#a18739598df499461369020b8ea6fff1c">mbedtls_ssl_get_ciphersuite</a>( ssl ) );</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">     * 5. Verify the server certificate</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot;  . Verifying peer X.509 certificate...&quot;</span> );</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="comment">/* In real life, we probably want to bail out when ret != 0 */</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">if</span>( ( flags = <a class="code" href="ssl_8h.html#a516064f1468d459159ef7cd6c496a026">mbedtls_ssl_get_verify_result</a>( ssl ) ) != 0 )</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    {</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <span class="keywordtype">char</span> vrfy_buf[512];</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; failed\n&quot;</span> );</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <a class="code" href="group__x509__module.html#gae88f1d8e6696eb2beeffe0a708219e6b">mbedtls_x509_crt_verify_info</a>( vrfy_buf, <span class="keyword">sizeof</span>( vrfy_buf ), <span class="stringliteral">&quot;  ! &quot;</span>, flags );</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot;%s\n&quot;</span>, vrfy_buf );</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    }</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; ok\n&quot;</span> );</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot;  . Peer certificate information    ...\n&quot;</span> );</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <a class="code" href="group__x509__module.html#gabaf30f2269fc3b6608b25871f9d09da6">mbedtls_x509_crt_info</a>( (<span class="keywordtype">char</span> *) buf, <span class="keyword">sizeof</span>( buf ) - 1, <span class="stringliteral">&quot;      &quot;</span>,</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                   <a class="code" href="ssl_8h.html#aa7ab0ac8d8341063a0f815ee99337831">mbedtls_ssl_get_peer_cert</a>( ssl ) );</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot;%s\n&quot;</span>, buf );</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;}</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> write_ssl_data( <a class="code" href="structmbedtls__ssl__context.html">mbedtls_ssl_context</a> *ssl, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> len )</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;{</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>(<span class="stringliteral">&quot;\n%s&quot;</span>, buf);</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keywordflow">while</span>( len &amp;&amp; ( ret = <a class="code" href="ssl_8h.html#a5bbda87d484de82df730758b475f32e5">mbedtls_ssl_write</a>( ssl, buf, len ) ) &lt;= 0 )</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    {</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="keywordflow">if</span>( ret != <a class="code" href="ssl_8h.html#a67a1e093cf042831aa60bb567915b560">MBEDTLS_ERR_SSL_WANT_READ</a> &amp;&amp; ret != <a class="code" href="ssl_8h.html#a674bde213fbbf602e04bbc131dd2dc33">MBEDTLS_ERR_SSL_WANT_WRITE</a> )</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        {</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; failed\n  ! mbedtls_ssl_write returned %d\n\n&quot;</span>, ret );</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        }</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    }</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;}</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> write_ssl_and_get_response( <a class="code" href="structmbedtls__ssl__context.html">mbedtls_ssl_context</a> *ssl, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> len )</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;{</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> data[128];</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordtype">char</span> code[4];</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordtype">size_t</span> i, idx = 0;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>(<span class="stringliteral">&quot;\n%s&quot;</span>, buf);</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">while</span>( len &amp;&amp; ( ret = <a class="code" href="ssl_8h.html#a5bbda87d484de82df730758b475f32e5">mbedtls_ssl_write</a>( ssl, buf, len ) ) &lt;= 0 )</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    {</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="keywordflow">if</span>( ret != <a class="code" href="ssl_8h.html#a67a1e093cf042831aa60bb567915b560">MBEDTLS_ERR_SSL_WANT_READ</a> &amp;&amp; ret != <a class="code" href="ssl_8h.html#a674bde213fbbf602e04bbc131dd2dc33">MBEDTLS_ERR_SSL_WANT_WRITE</a> )</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        {</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; failed\n  ! mbedtls_ssl_write returned %d\n\n&quot;</span>, ret );</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        }</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    }</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">do</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    {</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        len = <span class="keyword">sizeof</span>( data ) - 1;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        memset( data, 0, <span class="keyword">sizeof</span>( data ) );</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        ret = <a class="code" href="ssl_8h.html#aa2c29eeb1deaf5ad9f01a7515006ede5">mbedtls_ssl_read</a>( ssl, data, len );</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        <span class="keywordflow">if</span>( ret == <a class="code" href="ssl_8h.html#a67a1e093cf042831aa60bb567915b560">MBEDTLS_ERR_SSL_WANT_READ</a> || ret == <a class="code" href="ssl_8h.html#a674bde213fbbf602e04bbc131dd2dc33">MBEDTLS_ERR_SSL_WANT_WRITE</a> )</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <span class="keywordflow">if</span>( ret == <a class="code" href="ssl_8h.html#ac5e16e4c94a7e4ba0cf6b95c4547ddb1">MBEDTLS_ERR_SSL_PEER_CLOSE_NOTIFY</a> )</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        <span class="keywordflow">if</span>( ret &lt;= 0 )</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        {</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot;failed\n  ! mbedtls_ssl_read returned %d\n\n&quot;</span>, ret );</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        }</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>(<span class="stringliteral">&quot;\n%s&quot;</span>, data);</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        len = ret;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        <span class="keywordflow">for</span>( i = 0; i &lt; len; i++ )</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        {</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            <span class="keywordflow">if</span>( data[i] != <span class="charliteral">&#39;\n&#39;</span> )</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            {</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                <span class="keywordflow">if</span>( idx &lt; 4 )</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                    code[ idx++ ] = data[i];</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            }</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            <span class="keywordflow">if</span>( idx == 4 &amp;&amp; code[0] &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; code[0] &lt;= <span class="charliteral">&#39;9&#39;</span> &amp;&amp; code[3] == <span class="charliteral">&#39; &#39;</span> )</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            {</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                code[3] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                <span class="keywordflow">return</span> atoi( code );</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            }</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            idx = 0;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        }</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    }</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keywordflow">while</span>( 1 );</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;}</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> write_and_get_response( <a class="code" href="structmbedtls__net__context.html">mbedtls_net_context</a> *sock_fd, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> len )</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;{</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> data[128];</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keywordtype">char</span> code[4];</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordtype">size_t</span> i, idx = 0;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>(<span class="stringliteral">&quot;\n%s&quot;</span>, buf);</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="keywordflow">if</span>( len &amp;&amp; ( ret = <a class="code" href="net__sockets_8h.html#a4841afd0e14f1fd44b82c3a850961ab7">mbedtls_net_send</a>( sock_fd, buf, len ) ) &lt;= 0 )</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    {</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; failed\n  ! mbedtls_ssl_write returned %d\n\n&quot;</span>, ret );</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    }</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keywordflow">do</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    {</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        len = <span class="keyword">sizeof</span>( data ) - 1;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        memset( data, 0, <span class="keyword">sizeof</span>( data ) );</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        ret = <a class="code" href="net__sockets_8h.html#a03af351ec420bbeb5e91357abcfb3663">mbedtls_net_recv</a>( sock_fd, data, len );</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        <span class="keywordflow">if</span>( ret &lt;= 0 )</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        {</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot;failed\n  ! read returned %d\n\n&quot;</span>, ret );</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        }</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        data[len] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>(<span class="stringliteral">&quot;\n%s&quot;</span>, data);</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        len = ret;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="keywordflow">for</span>( i = 0; i &lt; len; i++ )</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        {</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            <span class="keywordflow">if</span>( data[i] != <span class="charliteral">&#39;\n&#39;</span> )</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            {</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                <span class="keywordflow">if</span>( idx &lt; 4 )</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                    code[ idx++ ] = data[i];</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;            }</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            <span class="keywordflow">if</span>( idx == 4 &amp;&amp; code[0] &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; code[0] &lt;= <span class="charliteral">&#39;9&#39;</span> &amp;&amp; code[3] == <span class="charliteral">&#39; &#39;</span> )</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            {</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                code[3] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                <span class="keywordflow">return</span> atoi( code );</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            }</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            idx = 0;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        }</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    }</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="keywordflow">while</span>( 1 );</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;}</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="keywordtype">int</span> <a class="code" href="ssl__mail__client_8c.html#a840291bc02cba5474a4cb46a9b9566fe">main</a>( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[] )</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;{</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordtype">int</span> ret = 0, len;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <a class="code" href="structmbedtls__net__context.html">mbedtls_net_context</a> server_fd;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buf[1024];</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_BASE64_C)</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> base[1024];</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keywordtype">char</span> hostname[32];</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *pers = <span class="stringliteral">&quot;ssl_mail_client&quot;</span>;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <a class="code" href="structmbedtls__entropy__context.html">mbedtls_entropy_context</a> entropy;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <a class="code" href="structmbedtls__ctr__drbg__context.html">mbedtls_ctr_drbg_context</a> ctr_drbg;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <a class="code" href="structmbedtls__ssl__context.html">mbedtls_ssl_context</a> ssl;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <a class="code" href="structmbedtls__ssl__config.html">mbedtls_ssl_config</a> <a class="code" href="namespaceconf.html">conf</a>;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> cacert;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> clicert;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <a class="code" href="structmbedtls__pk__context.html">mbedtls_pk_context</a> pkey;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordtype">size_t</span> n;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordtype">char</span> *p, *q;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> *list;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">     * Make sure memory references are valid in case we exit early.</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <a class="code" href="net__sockets_8h.html#aed7458e19fc1b4794f3a23aa3df49543">mbedtls_net_init</a>( &amp;server_fd );</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <a class="code" href="ssl_8h.html#a8560dea66d7830a11874188727ec4c45">mbedtls_ssl_init</a>( &amp;ssl );</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <a class="code" href="ssl_8h.html#aba55bcda50a47e83803e31a8db7c9a86">mbedtls_ssl_config_init</a>( &amp;conf );</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    memset( &amp;buf, 0, <span class="keyword">sizeof</span>( buf ) );</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <a class="code" href="group__x509__module.html#ga016dd06bc770e77b84005f305df20ed1">mbedtls_x509_crt_init</a>( &amp;cacert );</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <a class="code" href="group__x509__module.html#ga016dd06bc770e77b84005f305df20ed1">mbedtls_x509_crt_init</a>( &amp;clicert );</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <a class="code" href="pk_8h.html#a999d1160bb30c03d0c4382c3a9b0aa89">mbedtls_pk_init</a>( &amp;pkey );</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <a class="code" href="ctr__drbg_8h.html#a70dbec5e03601bf437ec488f2645743b">mbedtls_ctr_drbg_init</a>( &amp;ctr_drbg );</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordflow">if</span>( argc == 0 )</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    {</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    usage:</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <a class="code" href="aescrypt2_8c.html#a56fe9bff0a1be75aae2da3e593053e2c">USAGE</a> );</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        list = <a class="code" href="ssl_8h.html#aa475d287496d8a93a236a9b91b71dc87">mbedtls_ssl_list_ciphersuites</a>();</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <span class="keywordflow">while</span>( *list )</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        {</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>(<span class="stringliteral">&quot;    %s\n&quot;</span>, <a class="code" href="ssl_8h.html#ada9a0169e4712521049117d29b91e1e5">mbedtls_ssl_get_ciphersuite_name</a>( *list ) );</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            list++;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        }</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>(<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    }</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    opt.server_name         = DFL_SERVER_NAME;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    opt.server_port         = DFL_SERVER_PORT;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    opt.debug_level         = <a class="code" href="key__app_8c.html#a5788fa2aa47c6468f29c31c2bd7d7488">DFL_DEBUG_LEVEL</a>;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    opt.authentication      = DFL_AUTHENTICATION;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    opt.mode                = <a class="code" href="key__app_8c.html#a15d65445a8255b32e162d892f6627851">DFL_MODE</a>;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    opt.user_name           = DFL_USER_NAME;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    opt.user_pwd            = DFL_USER_PWD;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    opt.mail_from           = DFL_MAIL_FROM;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    opt.mail_to             = DFL_MAIL_TO;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    opt.ca_file             = DFL_CA_FILE;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    opt.crt_file            = DFL_CRT_FILE;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    opt.key_file            = DFL_KEY_FILE;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    opt.force_ciphersuite[0]= DFL_FORCE_CIPHER;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="keywordflow">for</span>( i = 1; i &lt; argc; i++ )</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    {</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        p = argv[i];</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <span class="keywordflow">if</span>( ( q = strchr( p, <span class="charliteral">&#39;=&#39;</span> ) ) == <a class="code" href="_s_e_g_g_e_r___r_t_t_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            <span class="keywordflow">goto</span> usage;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        *q++ = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="keywordflow">if</span>( strcmp( p, <span class="stringliteral">&quot;server_name&quot;</span> ) == 0 )</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            opt.server_name = q;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( strcmp( p, <span class="stringliteral">&quot;server_port&quot;</span> ) == 0 )</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            opt.server_port = q;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( strcmp( p, <span class="stringliteral">&quot;debug_level&quot;</span> ) == 0 )</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        {</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            opt.debug_level = atoi( q );</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            <span class="keywordflow">if</span>( opt.debug_level &lt; 0 || opt.debug_level &gt; 65535 )</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                <span class="keywordflow">goto</span> usage;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        }</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( strcmp( p, <span class="stringliteral">&quot;authentication&quot;</span> ) == 0 )</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        {</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            opt.authentication = atoi( q );</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            <span class="keywordflow">if</span>( opt.authentication &lt; 0 || opt.authentication &gt; 1 )</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                <span class="keywordflow">goto</span> usage;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        }</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( strcmp( p, <span class="stringliteral">&quot;mode&quot;</span> ) == 0 )</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        {</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;            opt.mode = atoi( q );</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;            <span class="keywordflow">if</span>( opt.mode &lt; 0 || opt.mode &gt; 1 )</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                <span class="keywordflow">goto</span> usage;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        }</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( strcmp( p, <span class="stringliteral">&quot;user_name&quot;</span> ) == 0 )</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            opt.user_name = q;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( strcmp( p, <span class="stringliteral">&quot;user_pwd&quot;</span> ) == 0 )</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;            opt.user_pwd = q;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( strcmp( p, <span class="stringliteral">&quot;mail_from&quot;</span> ) == 0 )</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            opt.mail_from = q;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( strcmp( p, <span class="stringliteral">&quot;mail_to&quot;</span> ) == 0 )</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;            opt.mail_to = q;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( strcmp( p, <span class="stringliteral">&quot;ca_file&quot;</span> ) == 0 )</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;            opt.ca_file = q;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( strcmp( p, <span class="stringliteral">&quot;crt_file&quot;</span> ) == 0 )</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;            opt.crt_file = q;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( strcmp( p, <span class="stringliteral">&quot;key_file&quot;</span> ) == 0 )</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;            opt.key_file = q;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( strcmp( p, <span class="stringliteral">&quot;force_ciphersuite&quot;</span> ) == 0 )</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        {</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            opt.force_ciphersuite[0] = -1;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            opt.force_ciphersuite[0] = <a class="code" href="ssl_8h.html#a9914cdf5533e813e1ea7ca52981aa006">mbedtls_ssl_get_ciphersuite_id</a>( q );</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;            <span class="keywordflow">if</span>( opt.force_ciphersuite[0] &lt;= 0 )</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                <span class="keywordflow">goto</span> usage;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;            opt.force_ciphersuite[1] = 0;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        }</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;            <span class="keywordflow">goto</span> usage;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    }</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">     * 0. Initialize the RNG and the session data</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot;\n  . Seeding the random number generator...&quot;</span> );</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    fflush( stdout );</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <a class="code" href="entropy_8h.html#aa901e027093c6fe65dee5760db78aced">mbedtls_entropy_init</a>( &amp;entropy );</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="keywordflow">if</span>( ( ret = <a class="code" href="ctr__drbg_8h.html#ad93d675f998550b4478c1fe6f4f34ebc">mbedtls_ctr_drbg_seed</a>( &amp;ctr_drbg, <a class="code" href="entropy_8h.html#a81765f6cdf4e5111bcb9f4324f3234cb">mbedtls_entropy_func</a>, &amp;entropy,</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                               (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) pers,</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                               strlen( pers ) ) ) != 0 )</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    {</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; failed\n  ! mbedtls_ctr_drbg_seed returned %d\n&quot;</span>, ret );</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    }</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; ok\n&quot;</span> );</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment">     * 1.1. Load the trusted CA</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot;  . Loading the CA root certificate ...&quot;</span> );</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    fflush( stdout );</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_FS_IO)</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="keywordflow">if</span>( strlen( opt.ca_file ) )</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        ret = <a class="code" href="group__x509__module.html#gad4da63133d3590aa311488497d4c38ec">mbedtls_x509_crt_parse_file</a>( &amp;cacert, opt.ca_file );</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_CERTS_C)</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        ret = <a class="code" href="group__x509__module.html#ga033567483649030f7f859db4f4cb7e14">mbedtls_x509_crt_parse</a>( &amp;cacert, (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) mbedtls_test_cas_pem,</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                              mbedtls_test_cas_pem_len );</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    {</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        ret = 1;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>(<span class="stringliteral">&quot;MBEDTLS_CERTS_C not defined.&quot;</span>);</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    }</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="keywordflow">if</span>( ret &lt; 0 )</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    {</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; failed\n  !  mbedtls_x509_crt_parse returned %d\n\n&quot;</span>, ret );</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    }</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; ok (%d skipped)\n&quot;</span>, ret );</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="comment">     * 1.2. Load own certificate and private key</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment">     * (can be skipped if client authentication is not required)</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot;  . Loading the client cert. and key...&quot;</span> );</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    fflush( stdout );</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_FS_IO)</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="keywordflow">if</span>( strlen( opt.crt_file ) )</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        ret = <a class="code" href="group__x509__module.html#gad4da63133d3590aa311488497d4c38ec">mbedtls_x509_crt_parse_file</a>( &amp;clicert, opt.crt_file );</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_CERTS_C)</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        ret = <a class="code" href="group__x509__module.html#ga033567483649030f7f859db4f4cb7e14">mbedtls_x509_crt_parse</a>( &amp;clicert, (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) <a class="code" href="certs_8h.html#afe99789e4a6f656cc031c397b0e0e1e7">mbedtls_test_cli_crt</a>,</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                              <a class="code" href="certs_8h.html#aa55a08b1d71b615c16f639713c987310">mbedtls_test_cli_crt_len</a> );</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    {</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        ret = -1;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>(<span class="stringliteral">&quot;MBEDTLS_CERTS_C not defined.&quot;</span>);</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    }</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="keywordflow">if</span>( ret != 0 )</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    {</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; failed\n  !  mbedtls_x509_crt_parse returned %d\n\n&quot;</span>, ret );</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    }</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_FS_IO)</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="keywordflow">if</span>( strlen( opt.key_file ) )</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        ret = <a class="code" href="pk_8h.html#a935d710e542409462d0209f2381da83e">mbedtls_pk_parse_keyfile</a>( &amp;pkey, opt.key_file, <span class="stringliteral">&quot;&quot;</span> );</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_CERTS_C) &amp;&amp; defined(MBEDTLS_PEM_PARSE_C)</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        ret = <a class="code" href="pk_8h.html#a072d27dc4143bfd600786232f9417e08">mbedtls_pk_parse_key</a>( &amp;pkey, (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) <a class="code" href="certs_8h.html#af58f3d2c5d4c87b42060fe823eac0afa">mbedtls_test_cli_key</a>,</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                <a class="code" href="certs_8h.html#a7afe0ec204727c1cc0f1ac8030714a2c">mbedtls_test_cli_key_len</a>, <a class="code" href="_s_e_g_g_e_r___r_t_t_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0 );</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    {</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        ret = -1;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>(<span class="stringliteral">&quot;MBEDTLS_CERTS_C or MBEDTLS_PEM_PARSE_C not defined.&quot;</span>);</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    }</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="keywordflow">if</span>( ret != 0 )</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    {</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; failed\n  !  mbedtls_pk_parse_key returned %d\n\n&quot;</span>, ret );</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    }</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; ok\n&quot;</span> );</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment">     * 2. Start the connection</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot;  . Connecting to tcp/%s/%s...&quot;</span>, opt.server_name,</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                                                opt.server_port );</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    fflush( stdout );</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="keywordflow">if</span>( ( ret = <a class="code" href="net__sockets_8h.html#ac12c400864a5aad46666828ce2a089a4">mbedtls_net_connect</a>( &amp;server_fd, opt.server_name,</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                             opt.server_port, <a class="code" href="net__sockets_8h.html#a989e1bc1aae7e48ac318d5ddd24efa3b">MBEDTLS_NET_PROTO_TCP</a> ) ) != 0 )</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    {</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; failed\n  ! mbedtls_net_connect returned %d\n\n&quot;</span>, ret );</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    }</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; ok\n&quot;</span> );</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="comment">     * 3. Setup stuff</span></div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot;  . Setting up the SSL/TLS structure...&quot;</span> );</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    fflush( stdout );</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="keywordflow">if</span>( ( ret = <a class="code" href="ssl_8h.html#aa1335b65ba57e81accc91ef95454d5a6">mbedtls_ssl_config_defaults</a>( &amp;conf,</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                    <a class="code" href="ssl_8h.html#a2064e7d9ad950b5979d2d6bab6ddc739">MBEDTLS_SSL_IS_CLIENT</a>,</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                    <a class="code" href="ssl_8h.html#acf690cf4772ff3e2df4b8295275e6fc7">MBEDTLS_SSL_TRANSPORT_STREAM</a>,</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                    <a class="code" href="ssl_8h.html#afb44a7bdf71d0a1472db0c70596599cb">MBEDTLS_SSL_PRESET_DEFAULT</a> ) ) != 0 )</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    {</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; failed\n  ! mbedtls_ssl_config_defaults returned %d\n\n&quot;</span>, ret );</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    }</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="comment">/* OPTIONAL is not optimal for security,</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment">     * but makes interop easier in this simplified example */</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <a class="code" href="ssl_8h.html#a5695285c9dbfefec295012b566290f37">mbedtls_ssl_conf_authmode</a>( &amp;conf, <a class="code" href="ssl_8h.html#a781032826cba362cda1c9201490d6f62">MBEDTLS_SSL_VERIFY_OPTIONAL</a> );</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <a class="code" href="ssl_8h.html#a469cd1c64bbba4be22347bf8874a017e">mbedtls_ssl_conf_rng</a>( &amp;conf, <a class="code" href="ctr__drbg_8h.html#af6e4dd295ae790a33128562dd01c79ab">mbedtls_ctr_drbg_random</a>, &amp;ctr_drbg );</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <a class="code" href="ssl_8h.html#ab15dcbe7c7fe2a5c118e7c486c07c921">mbedtls_ssl_conf_dbg</a>( &amp;conf, my_debug, stdout );</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keywordflow">if</span>( opt.force_ciphersuite[0] != DFL_FORCE_CIPHER )</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <a class="code" href="ssl_8h.html#ac8e4df37cadda8f743ed45501a51fec1">mbedtls_ssl_conf_ciphersuites</a>( &amp;conf, opt.force_ciphersuite );</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <a class="code" href="ssl_8h.html#a85c3bb6b682ba361d13de1c0a1eb69fb">mbedtls_ssl_conf_ca_chain</a>( &amp;conf, &amp;cacert, <a class="code" href="_s_e_g_g_e_r___r_t_t_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> );</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="keywordflow">if</span>( ( ret = <a class="code" href="ssl_8h.html#a4e54e9ace21beb608bae36ddb81a4fb0">mbedtls_ssl_conf_own_cert</a>( &amp;conf, &amp;clicert, &amp;pkey ) ) != 0 )</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    {</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; failed\n  ! mbedtls_ssl_conf_own_cert returned %d\n\n&quot;</span>, ret );</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    }</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="keywordflow">if</span>( ( ret = <a class="code" href="ssl_8h.html#af79cb539a0ee6ac20cf9c574f4c3b343">mbedtls_ssl_setup</a>( &amp;ssl, &amp;conf ) ) != 0 )</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    {</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; failed\n  ! mbedtls_ssl_setup returned %d\n\n&quot;</span>, ret );</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    }</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="keywordflow">if</span>( ( ret = <a class="code" href="ssl_8h.html#aa659024cf89e20d6d2248c0626db7ef2">mbedtls_ssl_set_hostname</a>( &amp;ssl, opt.server_name ) ) != 0 )</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    {</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; failed\n  ! mbedtls_ssl_set_hostname returned %d\n\n&quot;</span>, ret );</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    }</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <a class="code" href="ssl_8h.html#a8b7442420aef7f1a76fa8c5336362f9e">mbedtls_ssl_set_bio</a>( &amp;ssl, &amp;server_fd, <a class="code" href="net__sockets_8h.html#a4841afd0e14f1fd44b82c3a850961ab7">mbedtls_net_send</a>, <a class="code" href="net__sockets_8h.html#a03af351ec420bbeb5e91357abcfb3663">mbedtls_net_recv</a>, <a class="code" href="_s_e_g_g_e_r___r_t_t_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> );</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; ok\n&quot;</span> );</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="keywordflow">if</span>( opt.mode == MODE_SSL_TLS )</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    {</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <span class="keywordflow">if</span>( do_handshake( &amp;ssl ) != 0 )</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;            <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot;  &gt; Get header from server:&quot;</span> );</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        fflush( stdout );</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        ret = write_ssl_and_get_response( &amp;ssl, buf, 0 );</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        <span class="keywordflow">if</span>( ret &lt; 200 || ret &gt; 299 )</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        {</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;            <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; failed\n  ! server responded with %d\n\n&quot;</span>, ret );</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;            <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;        }</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>(<span class="stringliteral">&quot; ok\n&quot;</span> );</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot;  &gt; Write EHLO to server:&quot;</span> );</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        fflush( stdout );</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        gethostname( hostname, 32 );</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        len = sprintf( (<span class="keywordtype">char</span> *) buf, <span class="stringliteral">&quot;EHLO %s\r\n&quot;</span>, hostname );</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        ret = write_ssl_and_get_response( &amp;ssl, buf, len );</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        <span class="keywordflow">if</span>( ret &lt; 200 || ret &gt; 299 )</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        {</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;            <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; failed\n  ! server responded with %d\n\n&quot;</span>, ret );</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;            <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        }</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    }</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    {</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot;  &gt; Get header from server:&quot;</span> );</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        fflush( stdout );</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        ret = write_and_get_response( &amp;server_fd, buf, 0 );</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        <span class="keywordflow">if</span>( ret &lt; 200 || ret &gt; 299 )</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        {</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;            <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; failed\n  ! server responded with %d\n\n&quot;</span>, ret );</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;            <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        }</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>(<span class="stringliteral">&quot; ok\n&quot;</span> );</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot;  &gt; Write EHLO to server:&quot;</span> );</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        fflush( stdout );</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        gethostname( hostname, 32 );</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        len = sprintf( (<span class="keywordtype">char</span> *) buf, <span class="stringliteral">&quot;EHLO %s\r\n&quot;</span>, hostname );</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        ret = write_and_get_response( &amp;server_fd, buf, len );</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        <span class="keywordflow">if</span>( ret &lt; 200 || ret &gt; 299 )</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        {</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;            <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; failed\n  ! server responded with %d\n\n&quot;</span>, ret );</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;            <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        }</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>(<span class="stringliteral">&quot; ok\n&quot;</span> );</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot;  &gt; Write STARTTLS to server:&quot;</span> );</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        fflush( stdout );</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        gethostname( hostname, 32 );</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        len = sprintf( (<span class="keywordtype">char</span> *) buf, <span class="stringliteral">&quot;STARTTLS\r\n&quot;</span> );</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        ret = write_and_get_response( &amp;server_fd, buf, len );</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        <span class="keywordflow">if</span>( ret &lt; 200 || ret &gt; 299 )</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        {</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; failed\n  ! server responded with %d\n\n&quot;</span>, ret );</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        }</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>(<span class="stringliteral">&quot; ok\n&quot;</span> );</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        <span class="keywordflow">if</span>( do_handshake( &amp;ssl ) != 0 )</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;            <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    }</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_BASE64_C)</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <span class="keywordflow">if</span>( opt.authentication )</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    {</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot;  &gt; Write AUTH LOGIN to server:&quot;</span> );</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        fflush( stdout );</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        len = sprintf( (<span class="keywordtype">char</span> *) buf, <span class="stringliteral">&quot;AUTH LOGIN\r\n&quot;</span> );</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        ret = write_ssl_and_get_response( &amp;ssl, buf, len );</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        <span class="keywordflow">if</span>( ret &lt; 200 || ret &gt; 399 )</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        {</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;            <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; failed\n  ! server responded with %d\n\n&quot;</span>, ret );</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;            <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        }</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>(<span class="stringliteral">&quot; ok\n&quot;</span> );</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot;  &gt; Write username to server: %s&quot;</span>, opt.user_name );</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        fflush( stdout );</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        ret = <a class="code" href="base64_8h.html#a87c42fcb843b964e68015a46aad5bffd">mbedtls_base64_encode</a>( base, <span class="keyword">sizeof</span>( base ), &amp;n, (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) opt.user_name,</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                             strlen( opt.user_name ) );</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        <span class="keywordflow">if</span>( ret != 0 ) {</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;            <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; failed\n  ! mbedtls_base64_encode returned %d\n\n&quot;</span>, ret );</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;            <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        }</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        len = sprintf( (<span class="keywordtype">char</span> *) buf, <span class="stringliteral">&quot;%s\r\n&quot;</span>, base );</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        ret = write_ssl_and_get_response( &amp;ssl, buf, len );</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        <span class="keywordflow">if</span>( ret &lt; 300 || ret &gt; 399 )</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        {</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;            <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; failed\n  ! server responded with %d\n\n&quot;</span>, ret );</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;            <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        }</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>(<span class="stringliteral">&quot; ok\n&quot;</span> );</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot;  &gt; Write password to server: %s&quot;</span>, opt.user_pwd );</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        fflush( stdout );</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        ret = <a class="code" href="base64_8h.html#a87c42fcb843b964e68015a46aad5bffd">mbedtls_base64_encode</a>( base, <span class="keyword">sizeof</span>( base ), &amp;n, (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) opt.user_pwd,</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                             strlen( opt.user_pwd ) );</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        <span class="keywordflow">if</span>( ret != 0 ) {</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;            <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; failed\n  ! mbedtls_base64_encode returned %d\n\n&quot;</span>, ret );</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;            <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        }</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        len = sprintf( (<span class="keywordtype">char</span> *) buf, <span class="stringliteral">&quot;%s\r\n&quot;</span>, base );</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        ret = write_ssl_and_get_response( &amp;ssl, buf, len );</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        <span class="keywordflow">if</span>( ret &lt; 200 || ret &gt; 399 )</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        {</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;            <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; failed\n  ! server responded with %d\n\n&quot;</span>, ret );</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        }</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>(<span class="stringliteral">&quot; ok\n&quot;</span> );</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    }</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot;  &gt; Write MAIL FROM to server:&quot;</span> );</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    fflush( stdout );</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    len = sprintf( (<span class="keywordtype">char</span> *) buf, <span class="stringliteral">&quot;MAIL FROM:&lt;%s&gt;\r\n&quot;</span>, opt.mail_from );</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    ret = write_ssl_and_get_response( &amp;ssl, buf, len );</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <span class="keywordflow">if</span>( ret &lt; 200 || ret &gt; 299 )</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    {</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; failed\n  ! server responded with %d\n\n&quot;</span>, ret );</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    }</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>(<span class="stringliteral">&quot; ok\n&quot;</span> );</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot;  &gt; Write RCPT TO to server:&quot;</span> );</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    fflush( stdout );</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    len = sprintf( (<span class="keywordtype">char</span> *) buf, <span class="stringliteral">&quot;RCPT TO:&lt;%s&gt;\r\n&quot;</span>, opt.mail_to );</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    ret = write_ssl_and_get_response( &amp;ssl, buf, len );</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="keywordflow">if</span>( ret &lt; 200 || ret &gt; 299 )</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    {</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; failed\n  ! server responded with %d\n\n&quot;</span>, ret );</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    }</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>(<span class="stringliteral">&quot; ok\n&quot;</span> );</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot;  &gt; Write DATA to server:&quot;</span> );</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    fflush( stdout );</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    len = sprintf( (<span class="keywordtype">char</span> *) buf, <span class="stringliteral">&quot;DATA\r\n&quot;</span> );</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    ret = write_ssl_and_get_response( &amp;ssl, buf, len );</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="keywordflow">if</span>( ret &lt; 300 || ret &gt; 399 )</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    {</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; failed\n  ! server responded with %d\n\n&quot;</span>, ret );</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    }</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>(<span class="stringliteral">&quot; ok\n&quot;</span> );</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot;  &gt; Write content to server:&quot;</span> );</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    fflush( stdout );</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    len = sprintf( (<span class="keywordtype">char</span> *) buf, <span class="stringliteral">&quot;From: %s\r\nSubject: mbed TLS Test mail\r\n\r\n&quot;</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;            <span class="stringliteral">&quot;This is a simple test mail from the &quot;</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;            <span class="stringliteral">&quot;mbed TLS mail client example.\r\n&quot;</span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;            <span class="stringliteral">&quot;\r\n&quot;</span></div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;            <span class="stringliteral">&quot;Enjoy!&quot;</span>, opt.mail_from );</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    ret = write_ssl_data( &amp;ssl, buf, len );</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    len = sprintf( (<span class="keywordtype">char</span> *) buf, <span class="stringliteral">&quot;\r\n.\r\n&quot;</span>);</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    ret = write_ssl_and_get_response( &amp;ssl, buf, len );</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <span class="keywordflow">if</span>( ret &lt; 200 || ret &gt; 299 )</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    {</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot; failed\n  ! server responded with %d\n\n&quot;</span>, ret );</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        <span class="keywordflow">goto</span> exit;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    }</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>(<span class="stringliteral">&quot; ok\n&quot;</span> );</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <a class="code" href="ssl_8h.html#ac2c1b17128ead2df3082e27b603deb4c">mbedtls_ssl_close_notify</a>( &amp;ssl );</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;exit:</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    <a class="code" href="net__sockets_8h.html#a77c35cb3f4b9fe6035d1d3742f3b4a24">mbedtls_net_free</a>( &amp;server_fd );</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <a class="code" href="group__x509__module.html#gab33c1e4e20bea7ce536119f54a113c6b">mbedtls_x509_crt_free</a>( &amp;clicert );</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <a class="code" href="group__x509__module.html#gab33c1e4e20bea7ce536119f54a113c6b">mbedtls_x509_crt_free</a>( &amp;cacert );</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <a class="code" href="pk_8h.html#ac6a9786d96abfd73c4dff6814238feb9">mbedtls_pk_free</a>( &amp;pkey );</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <a class="code" href="ssl_8h.html#a2dc104a181bcd11eafbbf7e6923978bc">mbedtls_ssl_free</a>( &amp;ssl );</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <a class="code" href="ssl_8h.html#a7655f025440a6c5ccd4fc13832abb1dd">mbedtls_ssl_config_free</a>( &amp;conf );</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    <a class="code" href="ctr__drbg_8h.html#a1ea42b9eb6f6b33c82359f4c0a57ca43">mbedtls_ctr_drbg_free</a>( &amp;ctr_drbg );</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <a class="code" href="entropy_8h.html#a06778439f8a0e2daa2d3b444e06ad8dd">mbedtls_entropy_free</a>( &amp;entropy );</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;<span class="preprocessor">#if defined(_WIN32)</span></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <a class="code" href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a>( <span class="stringliteral">&quot;  + Press Enter to exit this program.\n&quot;</span> );</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    fflush( stdout ); getchar();</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;}</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* MBEDTLS_BIGNUM_C &amp;&amp; MBEDTLS_ENTROPY_C &amp;&amp; MBEDTLS_SSL_TLS_C &amp;&amp;</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="comment">          MBEDTLS_SSL_CLI_C &amp;&amp; MBEDTLS_NET_C &amp;&amp; MBEDTLS_RSA_C **</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="comment">          MBEDTLS_CTR_DRBG_C */</span><span class="preprocessor"></span></div><div class="ttc" id="certs_8h_html_af58f3d2c5d4c87b42060fe823eac0afa"><div class="ttname"><a href="certs_8h.html#af58f3d2c5d4c87b42060fe823eac0afa">mbedtls_test_cli_key</a></div><div class="ttdeci">const char * mbedtls_test_cli_key</div></div>
<div class="ttc" id="structmbedtls__ctr__drbg__context_html"><div class="ttname"><a href="structmbedtls__ctr__drbg__context.html">mbedtls_ctr_drbg_context</a></div><div class="ttdoc">CTR_DRBG context structure. </div><div class="ttdef"><b>Definition:</b> <a href="ctr__drbg_8h_source.html#l00087">ctr_drbg.h:87</a></div></div>
<div class="ttc" id="namespaceautothreadharness_1_1runner_html_afde8e18a788ccc92fc61cab298bca7e3"><div class="ttname"><a href="namespaceautothreadharness_1_1runner.html#afde8e18a788ccc92fc61cab298bca7e3">autothreadharness.runner.level</a></div><div class="ttdeci">level</div><div class="ttdef"><b>Definition:</b> <a href="runner_8py_source.html#l00045">runner.py:45</a></div></div>
<div class="ttc" id="aescrypt2_8c_html_a56fe9bff0a1be75aae2da3e593053e2c"><div class="ttname"><a href="aescrypt2_8c.html#a56fe9bff0a1be75aae2da3e593053e2c">USAGE</a></div><div class="ttdeci">#define USAGE</div><div class="ttdef"><b>Definition:</b> <a href="aescrypt2_8c_source.html#l00056">aescrypt2.c:56</a></div></div>
<div class="ttc" id="structmbedtls__pk__context_html"><div class="ttname"><a href="structmbedtls__pk__context.html">mbedtls_pk_context</a></div><div class="ttdoc">Public key container. </div><div class="ttdef"><b>Definition:</b> <a href="pk_8h_source.html#l00126">pk.h:126</a></div></div>
<div class="ttc" id="net__sockets_8h_html_a989e1bc1aae7e48ac318d5ddd24efa3b"><div class="ttname"><a href="net__sockets_8h.html#a989e1bc1aae7e48ac318d5ddd24efa3b">MBEDTLS_NET_PROTO_TCP</a></div><div class="ttdeci">#define MBEDTLS_NET_PROTO_TCP</div><div class="ttdef"><b>Definition:</b> <a href="net__sockets_8h_source.html#l00051">net_sockets.h:51</a></div></div>
<div class="ttc" id="certs_8h_html_afe99789e4a6f656cc031c397b0e0e1e7"><div class="ttname"><a href="certs_8h.html#afe99789e4a6f656cc031c397b0e0e1e7">mbedtls_test_cli_crt</a></div><div class="ttdeci">const char * mbedtls_test_cli_crt</div></div>
<div class="ttc" id="ssl_8h_html_ada9a0169e4712521049117d29b91e1e5"><div class="ttname"><a href="ssl_8h.html#ada9a0169e4712521049117d29b91e1e5">mbedtls_ssl_get_ciphersuite_name</a></div><div class="ttdeci">const char * mbedtls_ssl_get_ciphersuite_name(const int ciphersuite_id)</div><div class="ttdoc">Return the name of the ciphersuite associated with the given ID. </div></div>
<div class="ttc" id="ctr__drbg_8h_html_a1ea42b9eb6f6b33c82359f4c0a57ca43"><div class="ttname"><a href="ctr__drbg_8h.html#a1ea42b9eb6f6b33c82359f4c0a57ca43">mbedtls_ctr_drbg_free</a></div><div class="ttdeci">void mbedtls_ctr_drbg_free(mbedtls_ctr_drbg_context *ctx)</div><div class="ttdoc">Clear CTR_CRBG context data. </div></div>
<div class="ttc" id="pk_8h_html_a999d1160bb30c03d0c4382c3a9b0aa89"><div class="ttname"><a href="pk_8h.html#a999d1160bb30c03d0c4382c3a9b0aa89">mbedtls_pk_init</a></div><div class="ttdeci">void mbedtls_pk_init(mbedtls_pk_context *ctx)</div><div class="ttdoc">Initialize a mbedtls_pk_context (as NONE) </div></div>
<div class="ttc" id="base64_8h_html_a87c42fcb843b964e68015a46aad5bffd"><div class="ttname"><a href="base64_8h.html#a87c42fcb843b964e68015a46aad5bffd">mbedtls_base64_encode</a></div><div class="ttdeci">int mbedtls_base64_encode(unsigned char *dst, size_t dlen, size_t *olen, const unsigned char *src, size_t slen)</div><div class="ttdoc">Encode a buffer into base64 format. </div></div>
<div class="ttc" id="certs_8h_html_a7afe0ec204727c1cc0f1ac8030714a2c"><div class="ttname"><a href="certs_8h.html#a7afe0ec204727c1cc0f1ac8030714a2c">mbedtls_test_cli_key_len</a></div><div class="ttdeci">const size_t mbedtls_test_cli_key_len</div></div>
<div class="ttc" id="error_8h_html_a8c41c149b77a4807115b19c2af858558"><div class="ttname"><a href="error_8h.html#a8c41c149b77a4807115b19c2af858558">mbedtls_strerror</a></div><div class="ttdeci">void mbedtls_strerror(int errnum, char *buffer, size_t buflen)</div><div class="ttdoc">Translate a mbed TLS error code into a string representation, Result is truncated if necessary and al...</div></div>
<div class="ttc" id="net__sockets_8h_html_a77c35cb3f4b9fe6035d1d3742f3b4a24"><div class="ttname"><a href="net__sockets_8h.html#a77c35cb3f4b9fe6035d1d3742f3b4a24">mbedtls_net_free</a></div><div class="ttdeci">void mbedtls_net_free(mbedtls_net_context *ctx)</div><div class="ttdoc">Gracefully shutdown the connection and free associated data. </div></div>
<div class="ttc" id="ssl__mail__client_8c_html_a840291bc02cba5474a4cb46a9b9566fe"><div class="ttname"><a href="ssl__mail__client_8c.html#a840291bc02cba5474a4cb46a9b9566fe">main</a></div><div class="ttdeci">int main(void)</div><div class="ttdef"><b>Definition:</b> <a href="ssl__mail__client_8c_source.html#l00044">ssl_mail_client.c:44</a></div></div>
<div class="ttc" id="ctr__drbg_8h_html_a70dbec5e03601bf437ec488f2645743b"><div class="ttname"><a href="ctr__drbg_8h.html#a70dbec5e03601bf437ec488f2645743b">mbedtls_ctr_drbg_init</a></div><div class="ttdeci">void mbedtls_ctr_drbg_init(mbedtls_ctr_drbg_context *ctx)</div><div class="ttdoc">CTR_DRBG context initialization Makes the context ready for mbedtls_ctr_drbg_seed() or mbedtls_ctr_dr...</div></div>
<div class="ttc" id="ssl__mail__client_8c_html_af846397815d6b78aadc6ce9bb6bc9238"><div class="ttname"><a href="ssl__mail__client_8c.html#af846397815d6b78aadc6ce9bb6bc9238">mbedtls_printf</a></div><div class="ttdeci">#define mbedtls_printf</div><div class="ttdef"><b>Definition:</b> <a href="ssl__mail__client_8c_source.html#l00036">ssl_mail_client.c:36</a></div></div>
<div class="ttc" id="namespaceconf_html"><div class="ttname"><a href="namespaceconf.html">conf</a></div><div class="ttdef"><b>Definition:</b> <a href="conf_8py_source.html#l00001">conf.py:1</a></div></div>
<div class="ttc" id="net__sockets_8h_html_ac12c400864a5aad46666828ce2a089a4"><div class="ttname"><a href="net__sockets_8h.html#ac12c400864a5aad46666828ce2a089a4">mbedtls_net_connect</a></div><div class="ttdeci">int mbedtls_net_connect(mbedtls_net_context *ctx, const char *host, const char *port, int proto)</div><div class="ttdoc">Initiate a connection with host:port in the given protocol. </div></div>
<div class="ttc" id="config_8h_html"><div class="ttname"><a href="config_8h.html">config.h</a></div><div class="ttdoc">Configuration options (set of defines) </div></div>
<div class="ttc" id="ctr__drbg_8h_html_af6e4dd295ae790a33128562dd01c79ab"><div class="ttname"><a href="ctr__drbg_8h.html#af6e4dd295ae790a33128562dd01c79ab">mbedtls_ctr_drbg_random</a></div><div class="ttdeci">int mbedtls_ctr_drbg_random(void *p_rng, unsigned char *output, size_t output_len)</div><div class="ttdoc">CTR_DRBG generate random. </div></div>
<div class="ttc" id="ssl_8h_html_a516064f1468d459159ef7cd6c496a026"><div class="ttname"><a href="ssl_8h.html#a516064f1468d459159ef7cd6c496a026">mbedtls_ssl_get_verify_result</a></div><div class="ttdeci">uint32_t mbedtls_ssl_get_verify_result(const mbedtls_ssl_context *ssl)</div><div class="ttdoc">Return the result of the certificate verification. </div></div>
<div class="ttc" id="ssl_8h_html_afb44a7bdf71d0a1472db0c70596599cb"><div class="ttname"><a href="ssl_8h.html#afb44a7bdf71d0a1472db0c70596599cb">MBEDTLS_SSL_PRESET_DEFAULT</a></div><div class="ttdeci">#define MBEDTLS_SSL_PRESET_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="ssl_8h_source.html#l00185">ssl.h:185</a></div></div>
<div class="ttc" id="ssl_8h_html_aa7ab0ac8d8341063a0f815ee99337831"><div class="ttname"><a href="ssl_8h.html#aa7ab0ac8d8341063a0f815ee99337831">mbedtls_ssl_get_peer_cert</a></div><div class="ttdeci">const mbedtls_x509_crt * mbedtls_ssl_get_peer_cert(const mbedtls_ssl_context *ssl)</div><div class="ttdoc">Return the peer certificate from the current connection. </div></div>
<div class="ttc" id="entropy_8h_html_aa901e027093c6fe65dee5760db78aced"><div class="ttname"><a href="entropy_8h.html#aa901e027093c6fe65dee5760db78aced">mbedtls_entropy_init</a></div><div class="ttdeci">void mbedtls_entropy_init(mbedtls_entropy_context *ctx)</div><div class="ttdoc">Initialize the context. </div></div>
<div class="ttc" id="entropy_8h_html"><div class="ttname"><a href="entropy_8h.html">entropy.h</a></div><div class="ttdoc">Entropy accumulator implementation. </div></div>
<div class="ttc" id="ssl_8h_html_ac5e16e4c94a7e4ba0cf6b95c4547ddb1"><div class="ttname"><a href="ssl_8h.html#ac5e16e4c94a7e4ba0cf6b95c4547ddb1">MBEDTLS_ERR_SSL_PEER_CLOSE_NOTIFY</a></div><div class="ttdeci">#define MBEDTLS_ERR_SSL_PEER_CLOSE_NOTIFY</div><div class="ttdef"><b>Definition:</b> <a href="ssl_8h_source.html#l00077">ssl.h:77</a></div></div>
<div class="ttc" id="group__x509__module_html_gab33c1e4e20bea7ce536119f54a113c6b"><div class="ttname"><a href="group__x509__module.html#gab33c1e4e20bea7ce536119f54a113c6b">mbedtls_x509_crt_free</a></div><div class="ttdeci">void mbedtls_x509_crt_free(mbedtls_x509_crt *crt)</div><div class="ttdoc">Unallocate all certificate data. </div></div>
<div class="ttc" id="ssl_8h_html_a5bbda87d484de82df730758b475f32e5"><div class="ttname"><a href="ssl_8h.html#a5bbda87d484de82df730758b475f32e5">mbedtls_ssl_write</a></div><div class="ttdeci">int mbedtls_ssl_write(mbedtls_ssl_context *ssl, const unsigned char *buf, size_t len)</div><div class="ttdoc">Try to write exactly &amp;#39;len&amp;#39; application data bytes. </div></div>
<div class="ttc" id="ssl_8h_html_a2064e7d9ad950b5979d2d6bab6ddc739"><div class="ttname"><a href="ssl_8h.html#a2064e7d9ad950b5979d2d6bab6ddc739">MBEDTLS_SSL_IS_CLIENT</a></div><div class="ttdeci">#define MBEDTLS_SSL_IS_CLIENT</div><div class="ttdef"><b>Definition:</b> <a href="ssl_8h_source.html#l00136">ssl.h:136</a></div></div>
<div class="ttc" id="net__sockets_8h_html"><div class="ttname"><a href="net__sockets_8h.html">net_sockets.h</a></div><div class="ttdoc">Network communication functions. </div></div>
<div class="ttc" id="structmbedtls__entropy__context_html"><div class="ttname"><a href="structmbedtls__entropy__context.html">mbedtls_entropy_context</a></div><div class="ttdoc">Entropy context structure. </div><div class="ttdef"><b>Definition:</b> <a href="entropy_8h_source.html#l00122">entropy.h:122</a></div></div>
<div class="ttc" id="ssl_8h_html_ac2c1b17128ead2df3082e27b603deb4c"><div class="ttname"><a href="ssl_8h.html#ac2c1b17128ead2df3082e27b603deb4c">mbedtls_ssl_close_notify</a></div><div class="ttdeci">int mbedtls_ssl_close_notify(mbedtls_ssl_context *ssl)</div><div class="ttdoc">Notify the peer that the connection is being closed. </div></div>
<div class="ttc" id="error_8h_html"><div class="ttname"><a href="error_8h.html">error.h</a></div><div class="ttdoc">Error to string translation. </div></div>
<div class="ttc" id="structmbedtls__net__context_html"><div class="ttname"><a href="structmbedtls__net__context.html">mbedtls_net_context</a></div><div class="ttdef"><b>Definition:</b> <a href="net__sockets_8h_source.html#l00065">net_sockets.h:65</a></div></div>
<div class="ttc" id="ssl_8h_html_a2dc104a181bcd11eafbbf7e6923978bc"><div class="ttname"><a href="ssl_8h.html#a2dc104a181bcd11eafbbf7e6923978bc">mbedtls_ssl_free</a></div><div class="ttdeci">void mbedtls_ssl_free(mbedtls_ssl_context *ssl)</div><div class="ttdoc">Free referenced items in an SSL context and clear memory. </div></div>
<div class="ttc" id="ssl_8h_html_a674bde213fbbf602e04bbc131dd2dc33"><div class="ttname"><a href="ssl_8h.html#a674bde213fbbf602e04bbc131dd2dc33">MBEDTLS_ERR_SSL_WANT_WRITE</a></div><div class="ttdeci">#define MBEDTLS_ERR_SSL_WANT_WRITE</div><div class="ttdef"><b>Definition:</b> <a href="ssl_8h_source.html#l00106">ssl.h:106</a></div></div>
<div class="ttc" id="group__x509__module_html_ga033567483649030f7f859db4f4cb7e14"><div class="ttname"><a href="group__x509__module.html#ga033567483649030f7f859db4f4cb7e14">mbedtls_x509_crt_parse</a></div><div class="ttdeci">int mbedtls_x509_crt_parse(mbedtls_x509_crt *chain, const unsigned char *buf, size_t buflen)</div><div class="ttdoc">Parse one or more certificates and add them to the chained list. Parses permissively. If some certificates can be parsed, the result is the number of failed certificates it encountered. If none complete correctly, the first error is returned. </div></div>
<div class="ttc" id="entropy_8h_html_a81765f6cdf4e5111bcb9f4324f3234cb"><div class="ttname"><a href="entropy_8h.html#a81765f6cdf4e5111bcb9f4324f3234cb">mbedtls_entropy_func</a></div><div class="ttdeci">int mbedtls_entropy_func(void *data, unsigned char *output, size_t len)</div><div class="ttdoc">Retrieve entropy from the accumulator (Maximum length: MBEDTLS_ENTROPY_BLOCK_SIZE) (Thread-safe if MB...</div></div>
<div class="ttc" id="_s_e_g_g_e_r___r_t_t_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="_s_e_g_g_e_r___r_t_t_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="_s_e_g_g_e_r___r_t_t_8c_source.html#l00114">SEGGER_RTT.c:114</a></div></div>
<div class="ttc" id="pk_8h_html_a072d27dc4143bfd600786232f9417e08"><div class="ttname"><a href="pk_8h.html#a072d27dc4143bfd600786232f9417e08">mbedtls_pk_parse_key</a></div><div class="ttdeci">int mbedtls_pk_parse_key(mbedtls_pk_context *ctx, const unsigned char *key, size_t keylen, const unsigned char *pwd, size_t pwdlen)</div><div class="ttdoc">Parse a private key in PEM or DER format. </div></div>
<div class="ttc" id="stdint_8h_html_a435d1572bf3f880d55459d9805097f62"><div class="ttname"><a href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a></div><div class="ttdeci">unsigned int uint32_t</div><div class="ttdef"><b>Definition:</b> <a href="stdint_8h_source.html#l00038">stdint.h:38</a></div></div>
<div class="ttc" id="ssl_8h_html_a9914cdf5533e813e1ea7ca52981aa006"><div class="ttname"><a href="ssl_8h.html#a9914cdf5533e813e1ea7ca52981aa006">mbedtls_ssl_get_ciphersuite_id</a></div><div class="ttdeci">int mbedtls_ssl_get_ciphersuite_id(const char *ciphersuite_name)</div><div class="ttdoc">Return the ID of the ciphersuite associated with the given name. </div></div>
<div class="ttc" id="ssl_8h_html_aa475d287496d8a93a236a9b91b71dc87"><div class="ttname"><a href="ssl_8h.html#aa475d287496d8a93a236a9b91b71dc87">mbedtls_ssl_list_ciphersuites</a></div><div class="ttdeci">const int * mbedtls_ssl_list_ciphersuites(void)</div><div class="ttdoc">Returns the list of ciphersuites supported by the SSL/TLS module. </div></div>
<div class="ttc" id="net__sockets_8h_html_a4841afd0e14f1fd44b82c3a850961ab7"><div class="ttname"><a href="net__sockets_8h.html#a4841afd0e14f1fd44b82c3a850961ab7">mbedtls_net_send</a></div><div class="ttdeci">int mbedtls_net_send(void *ctx, const unsigned char *buf, size_t len)</div><div class="ttdoc">Write at most &amp;#39;len&amp;#39; characters. If no error occurs, the actual amount read is returned. </div></div>
<div class="ttc" id="ssl_8h_html_a8b7442420aef7f1a76fa8c5336362f9e"><div class="ttname"><a href="ssl_8h.html#a8b7442420aef7f1a76fa8c5336362f9e">mbedtls_ssl_set_bio</a></div><div class="ttdeci">void mbedtls_ssl_set_bio(mbedtls_ssl_context *ssl, void *p_bio, mbedtls_ssl_send_t *f_send, mbedtls_ssl_recv_t *f_recv, mbedtls_ssl_recv_timeout_t *f_recv_timeout)</div><div class="ttdoc">Set the underlying BIO callbacks for write, read and read-with-timeout. </div></div>
<div class="ttc" id="certs_8h_html_aa55a08b1d71b615c16f639713c987310"><div class="ttname"><a href="certs_8h.html#aa55a08b1d71b615c16f639713c987310">mbedtls_test_cli_crt_len</a></div><div class="ttdeci">const size_t mbedtls_test_cli_crt_len</div></div>
<div class="ttc" id="pk_8h_html_ac6a9786d96abfd73c4dff6814238feb9"><div class="ttname"><a href="pk_8h.html#ac6a9786d96abfd73c4dff6814238feb9">mbedtls_pk_free</a></div><div class="ttdeci">void mbedtls_pk_free(mbedtls_pk_context *ctx)</div><div class="ttdoc">Free a mbedtls_pk_context. </div></div>
<div class="ttc" id="key__app_8c_html_a15d65445a8255b32e162d892f6627851"><div class="ttname"><a href="key__app_8c.html#a15d65445a8255b32e162d892f6627851">DFL_MODE</a></div><div class="ttdeci">#define DFL_MODE</div><div class="ttdef"><b>Definition:</b> <a href="key__app_8c_source.html#l00048">key_app.c:48</a></div></div>
<div class="ttc" id="ssl_8h_html_a469cd1c64bbba4be22347bf8874a017e"><div class="ttname"><a href="ssl_8h.html#a469cd1c64bbba4be22347bf8874a017e">mbedtls_ssl_conf_rng</a></div><div class="ttdeci">void mbedtls_ssl_conf_rng(mbedtls_ssl_config *conf, int(*f_rng)(void *, unsigned char *, size_t), void *p_rng)</div><div class="ttdoc">Set the random number generator callback. </div></div>
<div class="ttc" id="ssl_8h_html_acf690cf4772ff3e2df4b8295275e6fc7"><div class="ttname"><a href="ssl_8h.html#acf690cf4772ff3e2df4b8295275e6fc7">MBEDTLS_SSL_TRANSPORT_STREAM</a></div><div class="ttdeci">#define MBEDTLS_SSL_TRANSPORT_STREAM</div><div class="ttdef"><b>Definition:</b> <a href="ssl_8h_source.html#l00122">ssl.h:122</a></div></div>
<div class="ttc" id="ssl_8h_html_a8560dea66d7830a11874188727ec4c45"><div class="ttname"><a href="ssl_8h.html#a8560dea66d7830a11874188727ec4c45">mbedtls_ssl_init</a></div><div class="ttdeci">void mbedtls_ssl_init(mbedtls_ssl_context *ssl)</div><div class="ttdoc">Initialize an SSL context Just makes the context ready for mbedtls_ssl_setup() or mbedtls_ssl_free() ...</div></div>
<div class="ttc" id="ssl_8h_html_a18739598df499461369020b8ea6fff1c"><div class="ttname"><a href="ssl_8h.html#a18739598df499461369020b8ea6fff1c">mbedtls_ssl_get_ciphersuite</a></div><div class="ttdeci">const char * mbedtls_ssl_get_ciphersuite(const mbedtls_ssl_context *ssl)</div><div class="ttdoc">Return the name of the current ciphersuite. </div></div>
<div class="ttc" id="ctr__drbg_8h_html_ad93d675f998550b4478c1fe6f4f34ebc"><div class="ttname"><a href="ctr__drbg_8h.html#ad93d675f998550b4478c1fe6f4f34ebc">mbedtls_ctr_drbg_seed</a></div><div class="ttdeci">int mbedtls_ctr_drbg_seed(mbedtls_ctr_drbg_context *ctx, int(*f_entropy)(void *, unsigned char *, size_t), void *p_entropy, const unsigned char *custom, size_t len)</div><div class="ttdoc">CTR_DRBG initial seeding Seed and setup entropy source for future reseeds. </div></div>
<div class="ttc" id="ssl_8h_html_ab15dcbe7c7fe2a5c118e7c486c07c921"><div class="ttname"><a href="ssl_8h.html#ab15dcbe7c7fe2a5c118e7c486c07c921">mbedtls_ssl_conf_dbg</a></div><div class="ttdeci">void mbedtls_ssl_conf_dbg(mbedtls_ssl_config *conf, void(*f_dbg)(void *, int, const char *, int, const char *), void *p_dbg)</div><div class="ttdoc">Set the debug callback. </div></div>
<div class="ttc" id="ssl_8h_html_aba55bcda50a47e83803e31a8db7c9a86"><div class="ttname"><a href="ssl_8h.html#aba55bcda50a47e83803e31a8db7c9a86">mbedtls_ssl_config_init</a></div><div class="ttdeci">void mbedtls_ssl_config_init(mbedtls_ssl_config *conf)</div><div class="ttdoc">Initialize an SSL configuration context Just makes the context ready for mbedtls_ssl_config_defaults(...</div></div>
<div class="ttc" id="x509_8h_html"><div class="ttname"><a href="x509_8h.html">x509.h</a></div><div class="ttdoc">X.509 generic defines and structures. </div></div>
<div class="ttc" id="ssl__mail__client_8c_html_a6d045f0c3699e1eac7f723054dc8b3e4"><div class="ttname"><a href="ssl__mail__client_8c.html#a6d045f0c3699e1eac7f723054dc8b3e4">mbedtls_fprintf</a></div><div class="ttdeci">#define mbedtls_fprintf</div><div class="ttdef"><b>Definition:</b> <a href="ssl__mail__client_8c_source.html#l00035">ssl_mail_client.c:35</a></div></div>
<div class="ttc" id="net__sockets_8h_html_aed7458e19fc1b4794f3a23aa3df49543"><div class="ttname"><a href="net__sockets_8h.html#aed7458e19fc1b4794f3a23aa3df49543">mbedtls_net_init</a></div><div class="ttdeci">void mbedtls_net_init(mbedtls_net_context *ctx)</div><div class="ttdoc">Initialize a context Just makes the context ready to be used or freed safely. </div></div>
<div class="ttc" id="entropy_8h_html_a06778439f8a0e2daa2d3b444e06ad8dd"><div class="ttname"><a href="entropy_8h.html#a06778439f8a0e2daa2d3b444e06ad8dd">mbedtls_entropy_free</a></div><div class="ttdeci">void mbedtls_entropy_free(mbedtls_entropy_context *ctx)</div><div class="ttdoc">Free the data in the context. </div></div>
<div class="ttc" id="group__x509__module_html_gabaf30f2269fc3b6608b25871f9d09da6"><div class="ttname"><a href="group__x509__module.html#gabaf30f2269fc3b6608b25871f9d09da6">mbedtls_x509_crt_info</a></div><div class="ttdeci">int mbedtls_x509_crt_info(char *buf, size_t size, const char *prefix, const mbedtls_x509_crt *crt)</div><div class="ttdoc">Returns an informational string about the certificate. </div></div>
<div class="ttc" id="pk_8h_html_a935d710e542409462d0209f2381da83e"><div class="ttname"><a href="pk_8h.html#a935d710e542409462d0209f2381da83e">mbedtls_pk_parse_keyfile</a></div><div class="ttdeci">int mbedtls_pk_parse_keyfile(mbedtls_pk_context *ctx, const char *path, const char *password)</div><div class="ttdoc">Load and parse a private key. </div></div>
<div class="ttc" id="group__x509__module_html_gad4da63133d3590aa311488497d4c38ec"><div class="ttname"><a href="group__x509__module.html#gad4da63133d3590aa311488497d4c38ec">mbedtls_x509_crt_parse_file</a></div><div class="ttdeci">int mbedtls_x509_crt_parse_file(mbedtls_x509_crt *chain, const char *path)</div><div class="ttdoc">Load one or more certificates and add them to the chained list. Parses permissively. If some certificates can be parsed, the result is the number of failed certificates it encountered. If none complete correctly, the first error is returned. </div></div>
<div class="ttc" id="base64_8h_html"><div class="ttname"><a href="base64_8h.html">base64.h</a></div><div class="ttdoc">RFC 1521 base64 encoding/decoding. </div></div>
<div class="ttc" id="ssl_8h_html_a4e54e9ace21beb608bae36ddb81a4fb0"><div class="ttname"><a href="ssl_8h.html#a4e54e9ace21beb608bae36ddb81a4fb0">mbedtls_ssl_conf_own_cert</a></div><div class="ttdeci">int mbedtls_ssl_conf_own_cert(mbedtls_ssl_config *conf, mbedtls_x509_crt *own_cert, mbedtls_pk_context *pk_key)</div><div class="ttdoc">Set own certificate chain and private key. </div></div>
<div class="ttc" id="ssl_8h_html_af79cb539a0ee6ac20cf9c574f4c3b343"><div class="ttname"><a href="ssl_8h.html#af79cb539a0ee6ac20cf9c574f4c3b343">mbedtls_ssl_setup</a></div><div class="ttdeci">int mbedtls_ssl_setup(mbedtls_ssl_context *ssl, const mbedtls_ssl_config *conf)</div><div class="ttdoc">Set up an SSL context for use. </div></div>
<div class="ttc" id="certs_8h_html"><div class="ttname"><a href="certs_8h.html">certs.h</a></div><div class="ttdoc">Sample certificates and DHM parameters for testing. </div></div>
<div class="ttc" id="structmbedtls__ssl__config_html"><div class="ttname"><a href="structmbedtls__ssl__config.html">mbedtls_ssl_config</a></div><div class="ttdef"><b>Definition:</b> <a href="ssl_8h_source.html#l00582">ssl.h:582</a></div></div>
<div class="ttc" id="structmbedtls__x509__crt_html"><div class="ttname"><a href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a></div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00052">x509_crt.h:52</a></div></div>
<div class="ttc" id="ssl_8h_html_a7655f025440a6c5ccd4fc13832abb1dd"><div class="ttname"><a href="ssl_8h.html#a7655f025440a6c5ccd4fc13832abb1dd">mbedtls_ssl_config_free</a></div><div class="ttdeci">void mbedtls_ssl_config_free(mbedtls_ssl_config *conf)</div><div class="ttdoc">Free an SSL configuration context. </div></div>
<div class="ttc" id="ssl_8h_html"><div class="ttname"><a href="ssl_8h.html">ssl.h</a></div><div class="ttdoc">SSL/TLS functions. </div></div>
<div class="ttc" id="ssl_8h_html_aa2c29eeb1deaf5ad9f01a7515006ede5"><div class="ttname"><a href="ssl_8h.html#aa2c29eeb1deaf5ad9f01a7515006ede5">mbedtls_ssl_read</a></div><div class="ttdeci">int mbedtls_ssl_read(mbedtls_ssl_context *ssl, unsigned char *buf, size_t len)</div><div class="ttdoc">Read at most &amp;#39;len&amp;#39; application data bytes. </div></div>
<div class="ttc" id="group__x509__module_html_ga016dd06bc770e77b84005f305df20ed1"><div class="ttname"><a href="group__x509__module.html#ga016dd06bc770e77b84005f305df20ed1">mbedtls_x509_crt_init</a></div><div class="ttdeci">void mbedtls_x509_crt_init(mbedtls_x509_crt *crt)</div><div class="ttdoc">Initialize a certificate (chain) </div></div>
<div class="ttc" id="ssl_8h_html_aa1335b65ba57e81accc91ef95454d5a6"><div class="ttname"><a href="ssl_8h.html#aa1335b65ba57e81accc91ef95454d5a6">mbedtls_ssl_config_defaults</a></div><div class="ttdeci">int mbedtls_ssl_config_defaults(mbedtls_ssl_config *conf, int endpoint, int transport, int preset)</div><div class="ttdoc">Load reasonnable default SSL configuration values. (You need to call mbedtls_ssl_config_init() first...</div></div>
<div class="ttc" id="ssl_8h_html_a85c3bb6b682ba361d13de1c0a1eb69fb"><div class="ttname"><a href="ssl_8h.html#a85c3bb6b682ba361d13de1c0a1eb69fb">mbedtls_ssl_conf_ca_chain</a></div><div class="ttdeci">void mbedtls_ssl_conf_ca_chain(mbedtls_ssl_config *conf, mbedtls_x509_crt *ca_chain, mbedtls_x509_crl *ca_crl)</div><div class="ttdoc">Set the data required to verify peer certificate. </div></div>
<div class="ttc" id="ssl_8h_html_a4a37e497cd08c896870a42b1b618186e"><div class="ttname"><a href="ssl_8h.html#a4a37e497cd08c896870a42b1b618186e">mbedtls_ssl_handshake</a></div><div class="ttdeci">int mbedtls_ssl_handshake(mbedtls_ssl_context *ssl)</div><div class="ttdoc">Perform the SSL handshake. </div></div>
<div class="ttc" id="group__x509__module_html_gae88f1d8e6696eb2beeffe0a708219e6b"><div class="ttname"><a href="group__x509__module.html#gae88f1d8e6696eb2beeffe0a708219e6b">mbedtls_x509_crt_verify_info</a></div><div class="ttdeci">int mbedtls_x509_crt_verify_info(char *buf, size_t size, const char *prefix, uint32_t flags)</div><div class="ttdoc">Returns an informational string about the verification status of a certificate. </div></div>
<div class="ttc" id="structmbedtls__ssl__context_html"><div class="ttname"><a href="structmbedtls__ssl__context.html">mbedtls_ssl_context</a></div><div class="ttdef"><b>Definition:</b> <a href="ssl_8h_source.html#l00755">ssl.h:755</a></div></div>
<div class="ttc" id="ssl_8h_html_a5695285c9dbfefec295012b566290f37"><div class="ttname"><a href="ssl_8h.html#a5695285c9dbfefec295012b566290f37">mbedtls_ssl_conf_authmode</a></div><div class="ttdeci">void mbedtls_ssl_conf_authmode(mbedtls_ssl_config *conf, int authmode)</div><div class="ttdoc">Set the certificate verification mode Default: NONE on server, REQUIRED on client. </div></div>
<div class="ttc" id="ssl_8h_html_aa659024cf89e20d6d2248c0626db7ef2"><div class="ttname"><a href="ssl_8h.html#aa659024cf89e20d6d2248c0626db7ef2">mbedtls_ssl_set_hostname</a></div><div class="ttdeci">int mbedtls_ssl_set_hostname(mbedtls_ssl_context *ssl, const char *hostname)</div><div class="ttdoc">Set the hostname to check against the received server certificate. It sets the ServerName TLS extensi...</div></div>
<div class="ttc" id="ssl_8h_html_a781032826cba362cda1c9201490d6f62"><div class="ttname"><a href="ssl_8h.html#a781032826cba362cda1c9201490d6f62">MBEDTLS_SSL_VERIFY_OPTIONAL</a></div><div class="ttdeci">#define MBEDTLS_SSL_VERIFY_OPTIONAL</div><div class="ttdef"><b>Definition:</b> <a href="ssl_8h_source.html#l00152">ssl.h:152</a></div></div>
<div class="ttc" id="key__app_8c_html_a5788fa2aa47c6468f29c31c2bd7d7488"><div class="ttname"><a href="key__app_8c.html#a5788fa2aa47c6468f29c31c2bd7d7488">DFL_DEBUG_LEVEL</a></div><div class="ttdeci">#define DFL_DEBUG_LEVEL</div><div class="ttdef"><b>Definition:</b> <a href="key__app_8c_source.html#l00052">key_app.c:52</a></div></div>
<div class="ttc" id="third__party_2mbedtls_2repo_2include_2mbedtls_2platform_8h_html"><div class="ttname"><a href="third__party_2mbedtls_2repo_2include_2mbedtls_2platform_8h.html">platform.h</a></div></div>
<div class="ttc" id="ssl_8h_html_ac8e4df37cadda8f743ed45501a51fec1"><div class="ttname"><a href="ssl_8h.html#ac8e4df37cadda8f743ed45501a51fec1">mbedtls_ssl_conf_ciphersuites</a></div><div class="ttdeci">void mbedtls_ssl_conf_ciphersuites(mbedtls_ssl_config *conf, const int *ciphersuites)</div><div class="ttdoc">Set the list of allowed ciphersuites and the preference order. First in the list has the highest pref...</div></div>
<div class="ttc" id="ssl_8h_html_a67a1e093cf042831aa60bb567915b560"><div class="ttname"><a href="ssl_8h.html#a67a1e093cf042831aa60bb567915b560">MBEDTLS_ERR_SSL_WANT_READ</a></div><div class="ttdeci">#define MBEDTLS_ERR_SSL_WANT_READ</div><div class="ttdef"><b>Definition:</b> <a href="ssl_8h_source.html#l00105">ssl.h:105</a></div></div>
<div class="ttc" id="net__sockets_8h_html_a03af351ec420bbeb5e91357abcfb3663"><div class="ttname"><a href="net__sockets_8h.html#a03af351ec420bbeb5e91357abcfb3663">mbedtls_net_recv</a></div><div class="ttdeci">int mbedtls_net_recv(void *ctx, unsigned char *buf, size_t len)</div><div class="ttdoc">Read at most &amp;#39;len&amp;#39; characters. If no error occurs, the actual amount read is returned. </div></div>
<div class="ttc" id="ctr__drbg_8h_html"><div class="ttname"><a href="ctr__drbg_8h.html">ctr_drbg.h</a></div><div class="ttdoc">CTR_DRBG based on AES-256 (NIST SP 800-90) </div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon May 15 2017 18:32:27 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
